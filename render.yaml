services:
  # 1. Сервис Redis для FSM (остается без изменений)
  - type: redis
    name: bot-redis
    plan: free
    ipAllowList: []
    maxmemoryPolicy: allkeys-lru

  # 2. НОВЫЙ сервис: База данных PostgreSQL
  - type: psql
    name: bot-database
    plan: free
    postgresMajorVersion: 14 # Версия PostgreSQL

  # 3. Наш бот-воркер (изменен)
  - type: worker
    name: telegram-shop-bot
    env: python
    plan: free
    buildCommand: "pip install -r requirements.txt"
    startCommand: "python bot.py"
    autoDeploy: yes
    # УДАЛЕНА секция disks
    envVars:
      - key: PYTHON_VERSION
        value: 3.11
      - key: REDIS_URL
        fromService:
          type: redis
          name: bot-redis
          property: connectionString
      # НОВАЯ переменная для подключения к PostgreSQL
      - key: DATABASE_URL
        fromService:
          type: psql
          name: bot-database
          property: connectionString
      # Секретные переменные остаются без изменений
      - key: BOT_TOKEN
        sync: false
      - key: ADMIN_USERNAMES
        sync: false
      - key: MANAGER_CONTACT
        sync: false
      - key: REQUIRED_CHANNEL
        sync: false
