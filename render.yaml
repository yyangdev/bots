services:
  # 1. Сервис Redis для FSM (без изменений)
  - type: redis
    name: bot-redis
    plan: free
    ipAllowList: []
    maxmemoryPolicy: allkeys-lru

  # 2. База данных PostgreSQL (ИЗМЕНЕНО)
  - type: database # <-- ВОТ ИСПРАВЛЕНИЕ: было "psql", стало "database"
    name: bot-database
    plan: free
    # Указываем, что это PostgreSQL. Render также поддерживает MySQL и т.д.
    databaseName: botdb # Имя самой базы данных внутри сервера
    user: botuser # Имя пользователя

  # 3. Наш бот-воркер (ИЗМЕНЕНО)
  - type: worker
    name: telegram-shop-bot
    env: python
    plan: free
    buildCommand: "pip install -r requirements.txt"
    startCommand: "python bot.py"
    autoDeploy: yes
    envVars:
      - key: PYTHON_VERSION
        value: 3.11
      - key: REDIS_URL
        fromService:
          type: redis
          name: bot-redis
          property: connectionString
      # Подключение к PostgreSQL (ИЗМЕНЕНО)
      - key: DATABASE_URL
        fromService:
          type: database # <-- ИСПРАВЛЕНИЕ: здесь тоже было "psql"
          name: bot-database
          property: connectionString
      # Секретные переменные (без изменений)
      - key: BOT_TOKEN
        sync: false
      - key: ADMIN_USERNAMES
        sync: false
      - key: MANAGER_CONTACT
        sync: false
      - key: REQUIRED_CHANNEL
        sync: false
