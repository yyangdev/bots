services:
  # 1. Сервис Redis для FSM.
  - type: redis
    name: bot-redis
    plan: free
    ipAllowList: []
    maxmemoryPolicy: allkeys-lru

  # 2. База данных PostgreSQL. ПРАВИЛЬНЫЙ ТИП - "psql".
  - type: psql
    name: bot-database
    plan: free
    postgresMajorVersion: 14

  # 3. Наш бот-воркер.
  - type: worker
    name: telegram-shop-bot
    env: python
    plan: free
    buildCommand: "pip install -r requirements.txt"
    startCommand: "python bot.py"
    autoDeploy: yes
    envVars:
      - key: PYTHON_VERSION
        value: 3.11
      - key: REDIS_URL
        fromService:
          type: redis
          name: bot-redis
          property: connectionString
      # Подключение к PostgreSQL. ПРАВИЛЬНЫЙ ТИП - "psql".
      - key: DATABASE_URL
        fromService:
          type: psql
          name: bot-database
          property: connectionString
      # Секретные переменные (без изменений).
      - key: BOT_TOKEN
        sync: false
      - key: ADMIN_USERNAMES
        sync: false
      - key: MANAGER_CONTACT
        sync: false
      - key: REQUIRED_CHANNEL
        sync: false
